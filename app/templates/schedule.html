{% extends "base.html" %}

{% block title %}週間時間割{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
        <h2 class="text-2xl font-bold text-slate-700 flex items-center gap-2">
            <i class="fas fa-calendar-week text-indigo-500"></i> 週間時間割
        </h2>
        
        <div class="flex items-center gap-2 bg-white p-1 rounded-lg border shadow-sm">
            <a href="{{ url_for('web.schedule', date=prev_week) }}" class="w-8 h-8 flex items-center justify-center text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded"><i class="fas fa-chevron-left"></i></a>
            <span class="font-bold text-slate-700 px-2">{{ display_date.strftime('%Y年%m月') }} 第{{ selected_kiki }}期</span>
            <a href="{{ url_for('web.schedule', date=next_week) }}" class="w-8 h-8 flex items-center justify-center text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded"><i class="fas fa-chevron-right"></i></a>
        </div>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full min-w-[800px] border-collapse">
                <thead>
                    <tr>
                        <th class="w-16 bg-slate-50 border-b border-r border-slate-200"></th>
                        {% for i in range(5) %}
                            {% set day = 曜日順[i] %}
                            {% set date = week_dates[i] %}
                            {% set is_today = (date.strftime('%Y-%m-%d') == now_date_str) %}
                            <th class="p-3 text-center border-b border-r border-slate-200 {{ 'bg-indigo-50 text-indigo-700' if is_today else 'bg-slate-50 text-slate-600' }}">
                                <div class="font-bold text-lg">{{ day }}</div>
                                <div class="text-xs font-normal opacity-70">{{ date.strftime('%m/%d') }}</div>
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for jigen in 時限一覧 %}
                    <tr>
                        <td class="p-3 text-center font-bold text-slate-500 bg-slate-50 border-b border-r border-slate-200">{{ jigen }}限</td>
                        {% for yobi in 曜日順 %}
                            {% set cell = schedule_grid[jigen][yobi] %}
                            {% set is_today = (cell.date_str == now_date_str) %}
                            <td class="p-3 border-b border-r border-slate-200 h-32 align-top transition hover:bg-slate-50 {{ 'bg-indigo-50/30' if is_today else '' }}">
                                {% if cell.status_label %}
                                    <div class="text-[10px] bg-rose-100 text-rose-600 px-1 rounded inline-block mb-1">{{ cell.status_label }}</div>
                                {% endif %}
                                
                                {% if not cell.is_empty %}
                                    <div class="flex flex-col h-full">
                                        <div class="font-bold text-slate-700 mb-1">
                                            {% if cell.is_exception %}<i class="fas fa-exclamation-circle text-amber-500 mr-1" title="変更あり"></i>{% endif %}
                                            {{ cell.display_text }}
                                        </div>
                                        {% if jigen != 5 %}
                                            <div class="text-xs text-slate-500 mt-auto">
                                                {% if cell.teacher %}<div><i class="fas fa-user-tie mr-1 text-slate-300"></i>{{ cell.teacher }}</div>{% endif %}
                                                {% if cell.room %}<div><i class="fas fa-map-marker-alt mr-1 text-slate-300"></i>{{ cell.room }}</div>{% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                {% else %}
                                    <div class="text-slate-200 text-center mt-8 text-2xl font-light">-</div>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
